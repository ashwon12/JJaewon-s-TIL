# 11ì›” 2ì¼ì˜ TIL


## web

### mini project  â‡’ [web-study/projects/moviestarë¡œ ì´ë™!](https://github.com/ashwon12/Web-study/tree/master/projects/movieStar)

**1. ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” APIë¥¼ DBì— ì €ì¥ì‹œí‚¤ëŠ” `init_db.py` íŒŒì¼ ìƒì„±**

BeautifulSoupì„ ì‚¬ìš©í•´ì„œ ê°’ë“¤ ê°€ì ¸ì˜¨ ë‹¤ìŒ dbì— ì €ì¥ì‹œí‚¨ë‹¤!

**2. í˜ì´ì§€ê°€ ë¡œë”©ë˜ì—ˆì„ ë•Œ** 

- ê¸°ë³¸ í™”ë©´

```jsx
@app.route('/')
def home():
    return render_template('index.html')
```

ì„œë²„ â†’ í´ë¼ì´ì–¸íŠ¸ë¡œ html,javascript,css ì¸ í™”ë©´ ì „ì†¡í•´ì¤€ë‹¤.

- ì„œë²„ì—ì„œ dbì˜ ë‚´ìš©ì„ ë¶ˆëŸ¬ì˜¨ë‹¤.

```python
@app.route('/api/list', methods=['GET'])
def show_stars():
    movie_list = list(db.mystar.find({}, {'_id': False}).sort('like',-1))

    return jsonify({'result': 'success','movieList':movie_list})
```

movie_list ë¼ëŠ” ì»¬ë ‰ì…˜ì—ì„œ ë„íë¨¼íŠ¸ì˜ '_id'ê°’ì„ ì œì™¸í•˜ê³  'like' ë¥¼ ì˜¤ë¦„ì°¨ìˆœìœ¼ë¡œ ì •ë ¬í•´ì„œ ê°’ë“¤ì„ ê°€ì ¸ì˜¨ë‹¤.

ê·¸ë¦¬ê³  í˜ì´ì§€ê°€ ë¡œë”©ë ë•Œ í´ë¼ì´ì–¸íŠ¸ë¡œ  movie_listë¥¼ ë³´ë‚´ì¤€ë‹¤.

- í´ë¼ì´ì–¸íŠ¸ì—ì„œ movie_list ìˆ˜ì‹ 

```jsx
function showStar() {
            $.ajax({
                type: 'GET',
                url: '/api/list',
                data: {},
                success: function (response) {
                    if (response['result'] == 'success') {
                        let List = response['movieList']
                        for (let i = 0; i <List.length ; i++) {
                            let data = List[i]

                            let name = data['name']
                            let img_url = data['img_url']
                            let like=data['like']
                            let recent = data['recent']
                            let url= data['url']

                            let temp = `htmlì´ ë“¤ì–´ê°€ëŠ” ë¶€ë¶„`

                            $("#star-box").append(temp)
                        }

                    }
                }
            });
        }
```

ì„œë²„ì—ì„œ ë³´ë‚¸ ë©”ì†Œë“œë°©ì‹('GET') url(/api/list') ì´ ì¼ì¹˜í•˜ëŠ” ajax í•¨ìˆ˜ê°€ ê°’ë“¤ì„ reponse í•œë‹¤. ë¹ˆ ë ˆì´ì•„ì›ƒ tempë¥¼ ìƒì„±í•´ì„œ ê°’ë“¤ì´ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ ì œì´ì¿¼ë¦¬ í˜•ì‹ìœ¼ë¡œ tempë¥¼ êµ¬ì„±í•´ì¤€ë‹¤. ê·¸ë¦¬ê³  ê°’ë“¤ì€ append í•´ì¤€ë‹¤.

**3. ì¢‹ì•„ìš” ë²„íŠ¼ì„ ëˆŒë €ì„ ë•Œ**

- ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¸ê°’ì˜ ì •ë³´(name)ì„ êº¼ë‚´ì™€ì„œ ì„œë²„ë¡œ ì†¡ì‹ í•œë‹¤.

```jsx
function likeStar(name) {
            $.ajax({
                type: 'POST',
                url: '/api/like',
                data: {
                    "name_give": name
                },
                success: function (response) {
                    if (response['result'] == 'success') {
                        let msg = response['msg'];
                        window.location.reload()
                        alert(msg);
                    }
                }
            });
        }
```

ë©”ì†Œë“œ ë°©ì‹ì´ 'POST'ì´ê³  urlì´ '/api/like' ì¸ ì„œë²„ì˜ í•¨ìˆ˜í•œí…Œ dataë¥¼ ë”•ì…”ë„ˆë¦¬ í˜•íƒœë¡œ ì „ë‹¬í•œë‹¤. ì „ë‹¬ì— ì„±ê³µí•˜ë©´ alert ì°½ê³¼ ìƒˆë¡œê³ ì¹¨ì„ í•´ì¤€ë‹¤.

- ì „ë‹¬ë°›ì€ ê°’ì— 1ì„ ë”í•´ DBë¥¼ update í•´ì¤€ë‹¤.

```python
@app.route('/api/like', methods=['POST'])
def like_star():
    name_receive = request.form['name_give']

    db.mystar.update_one({'name': name_receive}, {'$inc': {'like': 1}})

    # movie_star = db.mystar.find_one({'name': name_receive})
    # new_like = movie_star['like']+1
    # db.mystar.update_one({'name': name_receive}, {'$set': {'like': new_like}})

    return jsonify({'result': 'success', 'msg': name_receive +"ì˜ ì¢‹ì•„ìš”ê°€ ëˆŒë ¤ì¡Œì–´ìš”!ğŸ‘"})
```

ë°ì´í„°ë¥¼ ì „ë‹¬ë°›ì•„ì„œ dbì— update ì‹œì¼œì£¼ëŠ” ë°©ë²•ì— 2ê°€ì§€ê°€ ìˆë‹¤.

1. **$set** ì‚¬ìš© : ì£¼ì„ì²˜ë¦¬ ëœ ë¶€ë¶„
2. **$inc** ì‚¬ìš© 

ìƒí™©ì— ë”°ë¼ mongoDBì˜ update ë©”ì†Œë“œì˜ ì„¸ë¶€ê¸°ëŠ¥ë“¤ì„ í™•ì¸í•´ë³´ë©´ì„œ ì‚¬ìš©í•˜ì! ì•Œê² ëƒ!

4. ì‚­ì œëŠ” 3ë²ˆê³¼ ê°™ì€ ì›ë¦¬ë¡œ ë™ì‘.. mongoDBì˜ delete ë©”ì†Œë“œë¥¼ ì‚¬ìš©í•˜ë©´ ëœë‹¤.

5.  ë - âœ¨

6.  ë™ì‘ ì›ë¦¬ë¥¼ ì„¤ëª…í•˜ëŠ” ì¤‘ìš”í•œ ê·¸ë¦¼!

![1_ 013_crop](https://user-images.githubusercontent.com/55980680/97992351-e9332b00-1e25-11eb-8ac7-800a6756e180.jpeg)

<br><br>

## í•œì¤„í‰

ì—­ì‹œ ë°˜ë³µí•´ì•¼í•œë‹¤!! ë°˜ë³µë§Œì´ ë‹µ!! ì´ì œ ì™„ë²½í•˜ê²Œ ì´í•´ í•œ ê²ƒ ê°™ë‹¤.

ê°œì¸í”„ë¡œì íŠ¸ë¥¼ ì–´ë–¤ì‹ìœ¼ë¡œ ì§„í–‰í• ì§€ ì´ì œ ê¸°íší•´ì•¼ í•œë‹¤. ë¨¸ë¦¬ê°€ ë°êµ¬ë¥´ë¥´ë¥´ë¥´ë¥´ë¥´ë¥¼ë¥¼ë¥´ë¥´ë¥¼.......
